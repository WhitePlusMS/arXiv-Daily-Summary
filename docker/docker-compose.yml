# ArXiv æ¯æ—¥è®ºæ–‡æ¨èç³»ç»Ÿ Docker Compose é…ç½®
#
# ğŸ“– ä½¿ç”¨è¯´æ˜ï¼š
#   æ­¤é…ç½®ä» Docker Hub æ‹‰å–é¢„æ„å»ºçš„é•œåƒï¼Œæ— éœ€æœ¬åœ°æ„å»º
#   é€‚åˆå¿«é€Ÿéƒ¨ç½²ï¼Œæ— éœ€ä¸‹è½½æºç å’Œæ„å»ºç¯å¢ƒ
#
# ä½¿ç”¨æ–¹æ³•ï¼š
#   cd docker
#   docker compose up -d
#
# ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰ï¼š
#   BACKEND_PORT: åç«¯ç«¯å£ï¼ˆé»˜è®¤: 8000ï¼‰
#   FRONTEND_PORT: å‰ç«¯ç«¯å£ï¼ˆé»˜è®¤: 5173ï¼‰
#
# ç¤ºä¾‹ï¼šä¿®æ”¹ç«¯å£
#   FRONTEND_PORT=8080 BACKEND_PORT=8001 docker compose up -d

services:
  # åç«¯æœåŠ¡ - FastAPI
  backend:
    # ä» Docker Hub æ‹‰å–é•œåƒ
    image: whiteplusms/arxiv_daily_summary-backend:v0.3.3
    container_name: arxiv-daily-summary-backend
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    environment:
      #ç¦ç”¨ Python è¾“å‡ºç¼“å†²
      - PYTHONUNBUFFERED=1
      #ç¦ç”¨ Python å­—èŠ‚ç å†™å…¥
      - PYTHONDONTWRITEBYTECODE=1
    volumes:
      # .env.example ä½œä¸ºåªè¯»æ¨¡æ¿æ–‡ä»¶ï¼ˆéœ€è¦ä»é¡¹ç›®æ ¹ç›®å½•æŒ‚è½½ï¼‰
      - ../.env.example:/app/.env.example:ro
      # æŒä¹…åŒ–æ•°æ®ç›®å½•ï¼ˆ.env æ–‡ä»¶å°†ä¿å­˜åœ¨ user_data å·ä¸­ï¼‰
      - arxiv_history:/app/arxiv_history
      - user_data:/app/data
      - logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - arxiv-network
    restart: unless-stopped

  # å‰ç«¯æœåŠ¡ - Vue3 + Nginx
  frontend:
    # ä» Docker Hub æ‹‰å–é•œåƒ
    image: whiteplusms/arxiv_daily_summary-frontend:v0.3.3
    container_name: arxiv-daily-summary-frontend
    ports:
      - "${FRONTEND_PORT:-5173}:80"
    depends_on:
      - backend
    networks:
      - arxiv-network
    restart: unless-stopped

volumes:
  # æŒä¹…åŒ–æ•°æ®ç›®å½•ï¼ˆ.env æ–‡ä»¶ä¿å­˜åœ¨ user_data å·ä¸­ï¼‰
  arxiv_history:
    driver: local
  user_data:
    driver: local
  logs:
    driver: local

networks:
  arxiv-network:
    driver: bridge
